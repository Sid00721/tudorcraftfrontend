import{r as n,s as o,j as e,B as j,c as C,T as m,b as p,L as M,w as R,M as S,y as P,I as U}from"./index-3v-V_ujV.js";import{D as W}from"./Delete-CFLk6tfJ.js";import{A as q,L as G}from"./Link-0lEb7Lko.js";import{G as a}from"./Grid-CWEeYFsZ.js";import{F as T,T as f,I as $,S as z}from"./TextField-D9X8XuqD.js";import{R as O,a as I}from"./RadioGroup-B8f7XhuI.js";import{F as k}from"./FormControlLabel-XVNslV9S.js";import{T as H,a as J,b as K,c as b,d as i,e as Q}from"./TableRow-Ch5q5_jA.js";import"./isMuiElement-Dd43ylT-.js";import"./useControlled-2upcAsfy.js";function ae(){const[E,g]=n.useState(!0),[x,D]=n.useState([]),[F,A]=n.useState([]),[y,_]=n.useState(!1),[s,w]=n.useState({title:"",description:"",resource_type:"link",subject_id:"",resource_url:""}),[c,v]=n.useState(null),d=n.useCallback(async()=>{g(!0);const{data:t,error:r}=await o.from("resources").select("*, subjects(name)").order("created_at",{ascending:!1});r?console.error("Error fetching resources:",r.message):D(t||[]),g(!1)},[]);n.useEffect(()=>{(async()=>{await d();const{data:r}=await o.from("subjects").select("id, name").order("name");A(r||[])})()},[d]);const u=t=>{const{name:r,value:l}=t.target;w(h=>({...h,[r]:l}))},L=t=>{t.target.files&&t.target.files.length>0&&v(t.target.files[0])},B=async t=>{t.preventDefault(),_(!0);try{if(s.resource_type==="link"){const{error:r}=await o.from("resources").insert({title:s.title,description:s.description,resource_type:"link",resource_url:s.resource_url,subject_id:s.subject_id||null});if(r)throw r}else if(s.resource_type==="file"){if(!c)throw new Error("Please select a file to upload.");const r=`public/${Date.now()}_${c.name}`,{error:l}=await o.storage.from("resources").upload(r,c);if(l)throw l;const{error:h}=await o.from("resources").insert({title:s.title,description:s.description,resource_type:"file",storage_path:r,subject_id:s.subject_id||null});if(h)throw h}alert("Resource added successfully!"),w({title:"",description:"",resource_type:"link",subject_id:"",resource_url:""}),v(null),d()}catch(r){alert("Error adding resource: "+r.message)}finally{_(!1)}},N=async t=>{if(window.confirm(`Are you sure you want to delete "${t.title}"?`))try{if(t.resource_type==="file"&&t.storage_path){const{error:l}=await o.storage.from("resources").remove([t.storage_path]);if(l)throw l}const{error:r}=await o.from("resources").delete().eq("id",t.id);if(r)throw r;alert("Resource deleted successfully."),d()}catch(r){alert("Error deleting resource: "+r.message)}};return E&&x.length===0?e.jsx(j,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(C,{})}):e.jsxs(j,{sx:{p:3},children:[e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(m,{variant:"h4",children:"Resource Management"}),e.jsx(p,{component:M,to:"/",children:" ← Back to Dashboard"})]}),e.jsxs(R,{sx:{p:3,mt:4},children:[e.jsx(m,{variant:"h6",gutterBottom:!0,children:"Add New Resource"}),e.jsx("form",{onSubmit:B,children:e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:12,children:e.jsx(T,{children:e.jsxs(O,{row:!0,name:"resource_type",value:s.resource_type,onChange:u,children:[e.jsx(k,{value:"link",control:e.jsx(I,{}),label:"External Link"}),e.jsx(k,{value:"file",control:e.jsx(I,{}),label:"File Upload"})]})})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(f,{name:"title",label:"Title",value:s.title,onChange:u,fullWidth:!0,required:!0})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(f,{name:"description",label:"Description",value:s.description,onChange:u,fullWidth:!0,multiline:!0,rows:2})}),s.resource_type==="link"?e.jsx(a,{item:!0,xs:12,children:e.jsx(f,{name:"resource_url",label:"Resource URL",value:s.resource_url,onChange:u,fullWidth:!0,required:!0})}):e.jsxs(a,{item:!0,xs:12,children:[e.jsxs(p,{variant:"contained",component:"label",children:["Upload File",e.jsx("input",{type:"file",hidden:!0,onChange:L})]})," ",c&&e.jsx(m,{variant:"body2",component:"span",sx:{ml:2},children:c.name})]}),e.jsx(a,{item:!0,xs:12,children:e.jsxs(T,{fullWidth:!0,children:[e.jsx($,{children:"Optional: Assign to Subject"}),e.jsxs(z,{name:"subject_id",value:s.subject_id,label:"Optional: Assign to Subject",onChange:u,children:[e.jsx(S,{value:"",children:e.jsx("em",{children:"None"})}),F.map(t=>e.jsx(S,{value:t.id,children:t.name},t.id))]})]})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(p,{type:"submit",variant:"contained",disabled:y,children:y?e.jsx(C,{size:24}):"Add Resource"})})]})})]}),e.jsx(H,{component:R,sx:{mt:4},children:e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs(b,{children:[e.jsx(i,{children:"Type"}),e.jsx(i,{children:"Title"}),e.jsx(i,{children:"Subject"}),e.jsx(i,{align:"right",children:"Actions"})]})}),e.jsx(Q,{children:x.length>0?x.map(t=>{var r;return e.jsxs(b,{children:[e.jsx(i,{children:e.jsx(P,{icon:t.resource_type==="file"?e.jsx(q,{}):e.jsx(G,{}),label:t.resource_type,size:"small",variant:"outlined"})}),e.jsx(i,{children:t.title}),e.jsx(i,{children:((r=t.subjects)==null?void 0:r.name)||"N/A"}),e.jsx(i,{align:"right",children:e.jsx(U,{onClick:()=>N(t),color:"error",children:e.jsx(W,{})})})]},t.id)}):e.jsx(b,{children:e.jsx(i,{colSpan:4,align:"center",children:"No resources found."})})})]})})]})}export{ae as default};
