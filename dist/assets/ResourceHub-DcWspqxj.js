import{r as i,s as m,j as e,B as c,c as g,T as l,b as u,L as k,E,G as I}from"./index-3v-V_ujV.js";import{A as L,a as v,E as A,b as _}from"./ExpandMore-XLMqhgyC.js";import{L as C,A as B}from"./Link-0lEb7Lko.js";import{L as S}from"./ListItem-Da3YSJce.js";import"./useControlled-2upcAsfy.js";import"./isMuiElement-Dd43ylT-.js";function V(){const[y,p]=i.useState(!0),[x,b]=i.useState({}),[d,f]=i.useState(null),j=i.useCallback(async()=>{p(!0);const{data:t,error:s}=await m.from("resources").select("*, subjects(name)").order("created_at",{ascending:!1});if(s)console.error("Error fetching resources:",s.message);else{const r=(t||[]).reduce((n,h)=>{var a;const o=((a=h.subjects)==null?void 0:a.name)||"General Resources";return n[o]||(n[o]=[]),n[o].push(h),n},{});b(r)}p(!1)},[]);i.useEffect(()=>{j()},[j]);const w=async t=>{if(!t.storage_path){alert("Error: This resource has no file path specified.");return}f(t.id);try{const{data:{session:s},error:r}=await m.auth.getSession();if(r||!s)throw new Error("Authentication error. Please log in again.");const n=s.access_token,o=await fetch("undefined/api/resource/get-signed-url",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({storage_path:t.storage_path})}),a=await o.json();if(!o.ok)throw new Error(a.error||"Failed to retrieve file.");window.open(a.signedUrl,"_blank","noopener,noreferrer")}catch(s){console.error("Error viewing file:",s),alert(`Error: ${s.message}`)}finally{f(null)}};return y?e.jsx(c,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(g,{})}):e.jsxs(c,{sx:{p:3},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(l,{variant:"h4",children:"Resource Hub"}),e.jsx(u,{component:k,to:"/tutor/dashboard",children:" â† Back to Dashboard"})]}),e.jsx(l,{color:"text.secondary",children:"A library of materials to help you with your lessons."}),e.jsx(c,{sx:{mt:4},children:Object.keys(x).length>0?Object.entries(x).map(([t,s])=>e.jsxs(L,{defaultExpanded:!0,children:[e.jsx(v,{expandIcon:e.jsx(A,{}),children:e.jsx(l,{variant:"h6",children:t})}),e.jsx(_,{children:e.jsx(E,{children:s.map(r=>e.jsxs(S,{divider:!0,children:[e.jsx(I,{primary:r.title,secondary:r.description}),r.resource_type==="link"?e.jsx(u,{variant:"contained",href:r.resource_url,target:"_blank",rel:"noopener noreferrer",startIcon:e.jsx(C,{}),children:"Open Link"}):e.jsx(u,{variant:"contained",onClick:()=>w(r),startIcon:d===r.id?e.jsx(g,{size:20,color:"inherit"}):e.jsx(B,{}),disabled:d===r.id,children:d===r.id?"Loading...":"View File"})]},r.id))})})]},t)):e.jsx(l,{children:"No resources have been uploaded yet."})})]})}export{V as default};
