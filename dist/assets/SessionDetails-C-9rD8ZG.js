import{q as S,j as s,Q as L,x as M,r as a,s as O,B as r,c as d,C as g,T as n,b as x,L as A,a as b,P as W,z as w,y as $,S as N,A as q}from"./index-3v-V_ujV.js";import{u as G}from"./usePageTitle-seETqNZq.js";import{C as F}from"./Container-8dfa0TMF.js";import{G as y}from"./Grid-CWEeYFsZ.js";import{E as J}from"./Email-B3e4zQ06.js";import{P as V,S as D}from"./Search-TvqwLMnr.js";import{L as Q}from"./LocationOn-CTLLtjOz.js";import{S as U}from"./Schedule-DNHXDbJX.js";import{A as Y}from"./CheckCircle-DhXPYKmg.js";import{T as K,a as X,b as Z,c as j,d as i,e as ss}from"./TableRow-Ch5q5_jA.js";import{A as es}from"./Alert-Cd_pZj5V.js";import"./isMuiElement-Dd43ylT-.js";import"./Close-BLRrZJzV.js";const rs=S(s.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"})),ns=S(s.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m2 14H7v-2h7zm3-4H7v-2h10zm0-4H7V7h10z"})),os=S(s.jsx("path",{d:"M8 5v14l11-7z"})),B="https://tutor-matching-backend.onrender.com";function ps(){const{sessionId:c}=L(),C=M(),[_,v]=a.useState(!0),[o,E]=a.useState(null);G(o?`Session: ${o.parent_name}`:"Session Details");const[l,m]=a.useState([]),[h,I]=a.useState(!1),[u,T]=a.useState(!1),[f,k]=a.useState(null),p=a.useCallback(async()=>{v(!0);const{data:e,error:t}=await O.from("trial_sessions").select("*, trial_lessons(*, subjects(name)), assigned_tutor:assigned_tutor_id(full_name)").eq("id",c).single();t?(console.error("Error fetching session details",t),C("/")):E(e),v(!1)},[c,C]);a.useEffect(()=>{p()},[p]);const P=async()=>{I(!0),m([]);try{const e=await fetch(`${B}/api/sessions/${c}/match`,{method:"POST"}),t=await e.json();if(!e.ok)throw new Error(t.error||"Failed to fetch matches.");m(t.matchedTutors)}catch(e){console.error("Failed to fetch matches",e),alert("Error: "+e.message)}I(!1)},R=async e=>{k(e);try{const t=await fetch(`${B}/api/sessions/${c}/assign`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tutorId:e})}),z=await t.json();if(!t.ok)throw new Error(z.error||"Failed to assign tutor.");alert("Tutor successfully assigned!"),E(z.session),m([])}catch(t){console.error("Failed to assign tutor",t),alert("Error: "+t.message)}k(null)},H=async()=>{T(!0);try{const e=await fetch(`${B}/api/sessions/${c}/start-outreach`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({matchedTutors:l})}),t=await e.json();if(!e.ok)throw new Error(t.error||"Failed to start outreach.");alert("Automated outreach has begun!"),p()}catch(e){alert("Error: "+e.message)}T(!1)};return _?s.jsx(r,{sx:{backgroundColor:"#FAFBFC",minHeight:"100vh"},children:s.jsx(F,{maxWidth:"xl",sx:{py:4},children:s.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:s.jsx(d,{sx:{color:"#2D5BFF"}})})})}):o?s.jsx(r,{sx:{backgroundColor:"#FAFBFC",minHeight:"100vh"},children:s.jsxs(F,{maxWidth:"xl",sx:{py:4},children:[s.jsxs(r,{sx:{mb:6},children:[s.jsx(x,{component:A,to:"/",startIcon:s.jsx(rs,{}),sx:{mb:3,color:"#6B7280","&:hover":{backgroundColor:"#F4F6F8",color:"#374151"}},children:"Back to Dashboard"}),s.jsx(n,{variant:"h3",sx:{fontWeight:700,color:"#111827",mb:2},children:"Session Details"}),s.jsx(n,{variant:"body1",sx:{color:"#6B7280"},children:"Manage and track this trial session"})]}),s.jsxs(y,{container:!0,spacing:4,children:[s.jsxs(y,{item:!0,xs:12,lg:5,children:[s.jsx(g,{sx:{border:"1px solid #E4E7EB",borderRadius:3,mb:4},children:s.jsxs(b,{sx:{p:4},children:[s.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[s.jsx(r,{sx:{width:40,height:40,borderRadius:2,backgroundColor:"#EBF0FF",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(W,{sx:{fontSize:20,color:"#2D5BFF"}})}),s.jsx(n,{variant:"h6",sx:{fontWeight:600,color:"#111827"},children:"Session Information"})]}),s.jsxs(w,{spacing:3,children:[s.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[s.jsx(W,{sx:{fontSize:18,color:"#6B7280"}}),s.jsxs(r,{children:[s.jsx(n,{variant:"body2",sx:{color:"#6B7280",fontSize:"0.75rem"},children:"Parent"}),s.jsx(n,{variant:"body1",sx:{fontWeight:500,color:"#111827"},children:o.parent_name})]})]}),s.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[s.jsx(J,{sx:{fontSize:18,color:"#6B7280"}}),s.jsxs(r,{children:[s.jsx(n,{variant:"body2",sx:{color:"#6B7280",fontSize:"0.75rem"},children:"Email"}),s.jsx(n,{variant:"body1",sx:{fontWeight:500,color:"#111827"},children:o.parent_email})]})]}),o.parent_phone&&s.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[s.jsx(V,{sx:{fontSize:18,color:"#6B7280"}}),s.jsxs(r,{children:[s.jsx(n,{variant:"body2",sx:{color:"#6B7280",fontSize:"0.75rem"},children:"Phone"}),s.jsx(n,{variant:"body1",sx:{fontWeight:500,color:"#111827"},children:o.parent_phone})]})]}),s.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[s.jsx(Q,{sx:{fontSize:18,color:"#6B7280"}}),s.jsxs(r,{children:[s.jsx(n,{variant:"body2",sx:{color:"#6B7280",fontSize:"0.75rem"},children:"Location"}),s.jsx(n,{variant:"body1",sx:{fontWeight:500,color:"#111827"},children:o.location})]})]}),s.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[s.jsx(U,{sx:{fontSize:18,color:"#6B7280"}}),s.jsxs(r,{children:[s.jsx(n,{variant:"body2",sx:{color:"#6B7280",fontSize:"0.75rem"},children:"Status"}),s.jsx($,{label:o.status,size:"small",sx:{backgroundColor:o.status==="Confirmed"?"#ECFDF5":o.status==="Pending"?"#FFFBEB":"#FEF2F2",color:o.status==="Confirmed"?"#10B981":o.status==="Pending"?"#F59E0B":"#EF4444",border:`1px solid ${o.status==="Confirmed"?"#D1FAE5":o.status==="Pending"?"#FED7AA":"#FECACA"}`,fontWeight:600}})]})]}),o.assigned_tutor&&s.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[s.jsx(Y,{sx:{fontSize:18,color:"#10B981"}}),s.jsxs(r,{children:[s.jsx(n,{variant:"body2",sx:{color:"#6B7280",fontSize:"0.75rem"},children:"Assigned Tutor"}),s.jsx(n,{variant:"body1",sx:{fontWeight:600,color:"#10B981"},children:o.assigned_tutor.full_name})]})]})]})]})}),s.jsx(g,{sx:{border:"1px solid #E4E7EB",borderRadius:3},children:s.jsxs(b,{sx:{p:4},children:[s.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[s.jsx(r,{sx:{width:40,height:40,borderRadius:2,backgroundColor:"#FFF0EB",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(N,{sx:{fontSize:20,color:"#FF6B2C"}})}),s.jsx(n,{variant:"h6",sx:{fontWeight:600,color:"#111827"},children:"Lessons in this Session"})]}),s.jsx(w,{spacing:2,children:o.trial_lessons.map((e,t)=>s.jsxs(r,{sx:{p:3,border:"1px solid #E4E7EB",borderRadius:2,backgroundColor:"#FAFBFC"},children:[s.jsxs(n,{variant:"body1",sx:{fontWeight:600,color:"#111827",mb:1},children:[e.subjects.name," - Grade ",e.student_grade]}),s.jsxs(n,{variant:"body2",sx:{color:"#6B7280"},children:["Student: ",e.student_name]})]},e.id))})]})})]}),s.jsx(y,{item:!0,xs:12,lg:7,children:s.jsx(g,{sx:{border:"1px solid #E4E7EB",borderRadius:3},children:s.jsxs(b,{sx:{p:4},children:[s.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:4},children:[s.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[s.jsx(r,{sx:{width:40,height:40,borderRadius:2,backgroundColor:"#FFF0EB",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(D,{sx:{fontSize:20,color:"#FF6B2C"}})}),s.jsx(n,{variant:"h6",sx:{fontWeight:600,color:"#111827"},children:"Tutor Matching"})]}),o.status==="Pending"&&s.jsx(x,{variant:"contained",onClick:P,disabled:h,startIcon:h?s.jsx(d,{size:16,color:"inherit"}):s.jsx(D,{}),sx:{background:"linear-gradient(135deg, #2D5BFF 0%, #1E47E6 100%)",borderRadius:2,px:3,py:1.5,fontWeight:600,textTransform:"none","&:hover":{background:"linear-gradient(135deg, #1E47E6 0%, #1538CC 100%)"}},children:h?"Searching...":"Find Matching Tutors"})]}),s.jsx(r,{sx:{border:"1px solid #E4E7EB",borderRadius:2,overflow:"hidden"},children:s.jsx(K,{children:s.jsxs(X,{className:"premium-table",children:[s.jsx(Z,{children:s.jsxs(j,{children:[s.jsx(i,{sx:{fontWeight:600,color:"#6B7280",fontSize:"0.75rem",textTransform:"uppercase"},children:"Name"}),s.jsx(i,{sx:{fontWeight:600,color:"#6B7280",fontSize:"0.75rem",textTransform:"uppercase"},children:"Location"}),s.jsx(i,{sx:{fontWeight:600,color:"#6B7280",fontSize:"0.75rem",textTransform:"uppercase"},children:"Travel Time"}),s.jsx(i,{align:"right",sx:{fontWeight:600,color:"#6B7280",fontSize:"0.75rem",textTransform:"uppercase"},children:"Actions"})]})}),s.jsx(ss,{children:h?s.jsx(j,{children:s.jsx(i,{colSpan:4,align:"center",sx:{py:6},children:s.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[s.jsx(d,{sx:{color:"#2D5BFF"}}),s.jsx(n,{variant:"body2",sx:{color:"#6B7280"},children:"Finding qualified tutors..."})]})})}):l.length>0?l.map(e=>{var t;return s.jsxs(j,{sx:{"&:hover":{backgroundColor:"#FAFBFC"}},children:[s.jsx(i,{children:s.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[s.jsx(q,{sx:{width:32,height:32,backgroundColor:"#2D5BFF",fontSize:"0.875rem"},children:((t=e.full_name)==null?void 0:t[0])||"T"}),s.jsx(n,{variant:"body2",sx:{fontWeight:500,color:"#111827"},children:e.full_name})]})}),s.jsx(i,{children:s.jsx(n,{variant:"body2",sx:{color:"#6B7280"},children:e.suburb})}),s.jsx(i,{children:s.jsx(n,{variant:"body2",sx:{color:"#6B7280"},children:e.travelTimeText||"N/A"})}),s.jsx(i,{align:"right",children:s.jsx(x,{variant:"outlined",size:"small",disabled:f!==null,onClick:()=>R(e.id),startIcon:f===e.id?s.jsx(d,{size:14,color:"inherit"}):s.jsx(ns,{sx:{fontSize:14}}),sx:{borderColor:"#E4E7EB",color:"#374151",fontWeight:500,textTransform:"none","&:hover":{borderColor:"#2D5BFF",backgroundColor:"#EBF0FF",color:"#2D5BFF"}},children:f===e.id?"Assigning...":"Assign"})})]},e.id)}):s.jsx(j,{children:s.jsxs(i,{colSpan:4,align:"center",sx:{py:6},children:[s.jsx(n,{variant:"body2",sx:{color:"#6B7280"},children:"No tutors matched yet."}),s.jsx(n,{variant:"caption",sx:{color:"#9DA4AE"},children:'Click "Find Matching Tutors" to search for qualified tutors'})]})})})]})})}),l.length>0&&o.status==="Pending"&&s.jsxs(es,{severity:"success",sx:{mt:4,backgroundColor:"#ECFDF5",border:"1px solid #D1FAE5",borderRadius:2},action:s.jsx(x,{variant:"contained",disabled:u,onClick:H,startIcon:u?s.jsx(d,{size:16,color:"inherit"}):s.jsx(os,{}),sx:{background:"linear-gradient(135deg, #10B981 0%, #059669 100%)",fontWeight:600,textTransform:"none","&:hover":{background:"linear-gradient(135deg, #059669 0%, #047857 100%)"}},children:u?"Starting...":"Start Outreach"}),children:[s.jsx(n,{variant:"body2",sx:{fontWeight:600,color:"#111827"},children:"Ready to Go!"}),s.jsxs(n,{variant:"body2",sx:{color:"#6B7280"},children:["You have a shortlist of ",l.length," qualified tutor",l.length!==1?"s":"",". Start automated outreach to contact them."]})]})]})})})]})]})}):s.jsx(r,{sx:{backgroundColor:"#FAFBFC",minHeight:"100vh"},children:s.jsx(F,{maxWidth:"xl",sx:{py:4},children:s.jsxs(g,{sx:{border:"1px solid #E4E7EB",borderRadius:3,p:6,textAlign:"center"},children:[s.jsx(n,{variant:"h6",sx:{color:"#6B7280",mb:2},children:"Session not found"}),s.jsx(x,{component:A,to:"/",variant:"contained",children:"Go back to Dashboard"})]})})})}export{ps as default};
