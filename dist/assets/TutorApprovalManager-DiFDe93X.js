import{r as n,s as x,j as e,B as o,c as D,T as s,C as R,a as q,A as B,P as F,z as M,S as V,y as j,b as p,w as f}from"./index-3v-V_ujV.js";import{u as G,a as H}from"./usePageTitle-seETqNZq.js";import{C as Y}from"./Container-8dfa0TMF.js";import{T as N}from"./TextField-D9X8XuqD.js";import{S as J,P as K}from"./Search-TvqwLMnr.js";import{G as i}from"./Grid-CWEeYFsZ.js";import{E as Q}from"./Email-B3e4zQ06.js";import{L as X}from"./LocationOn-CTLLtjOz.js";import{V as Z}from"./Visibility-CjhNTLSy.js";import{D as ee,a as re,b as se,c as te}from"./DialogTitle-DjXGIgXC.js";import{R as ae}from"./Rating-fyB5SVPr.js";import{A as oe}from"./Alert-Cd_pZj5V.js";import{R as ie}from"./Cancel-4DEfXCDE.js";import{A as ne}from"./CheckCircle-DhXPYKmg.js";import"./useControlled-2upcAsfy.js";import"./isMuiElement-Dd43ylT-.js";import"./Close-BLRrZJzV.js";function Ce(){const[P,v]=n.useState(!0),[c,z]=n.useState([]),[g,b]=n.useState([]);G(`Tutor Approvals (${c.filter(r=>r.profile_complete).length} ready)`),n.useEffect(()=>{H("admin")},[]);const[t,y]=n.useState(null),[L,d]=n.useState(!1),[_,w]=n.useState(""),[h,S]=n.useState(!1),[C,W]=n.useState(null),k={success:r=>alert(r),error:r=>alert(r)};n.useEffect(()=>{(async()=>{const{data:{session:a}}=await x.auth.getSession();W(a==null?void 0:a.user)})()},[]);const u=n.useCallback(async()=>{v(!0);try{const{data:r,error:a}=await x.from("tutors_pending_approval").select("*").order("profile_complete",{ascending:!1}).order("last_profile_update",{ascending:!1});if(a)throw a;z(r||[]),b(r||[])}catch(r){console.error("Error fetching tutors:",r),alert("Error loading tutors: "+r.message)}finally{v(!1)}},[]);n.useEffect(()=>{u()},[u]);const $=async r=>{try{const{data:a,error:l}=await x.from("tutors").select(`
                    *,
                    subjects:tutor_subjects(subject_id, subjects(name, state_curriculum, level))
                `).eq("id",r).single();if(l)throw l;y(a),d(!0)}catch(a){console.error("Error fetching tutor details:",a),alert("Error loading tutor details: "+a.message)}},A=async r=>{if(!(!t||!C)){S(!0);try{const a={approval_status:r,approved_by:C.id,approved_at:new Date().toISOString(),approval_notes:_||null},{error:l}=await x.from("tutors").update(a).eq("id",t.id);if(l)throw l;await u(),d(!1),y(null),w(""),k.success(`${t.full_name} has been ${r}! ${r==="approved"?"They can now receive student assignments.":"They will need to reapply or contact support."}`,{title:`Tutor ${r==="approved"?"Approved":"Rejected"}`,duration:6e3})}catch(a){console.error("Error updating approval status:",a),alert("Error updating approval: "+a.message)}finally{S(!1)}}},O=r=>{switch(r){case"approved":return"success";case"rejected":return"error";case"suspended":return"warning";default:return"default"}},U=r=>r==="Ready for review"?"success":"warning";return P?e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:e.jsx(D,{})}):e.jsx(o,{sx:{backgroundColor:"#FAFBFC",minHeight:"100vh"},children:e.jsxs(Y,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(o,{sx:{mb:6},children:[e.jsx(s,{variant:"h3",sx:{fontWeight:700,color:"#111827",mb:2},children:"Tutor Approvals"}),e.jsx(s,{variant:"body1",sx:{color:"#6B7280",mb:4},children:"Review and approve tutors before they can be assigned to students"}),e.jsx(N,{fullWidth:!0,placeholder:"Search tutors by name, email, or location...",onChange:r=>{const a=r.target.value.toLowerCase(),l=c.filter(m=>{var I,E,T;return((I=m.full_name)==null?void 0:I.toLowerCase().includes(a))||((E=m.email)==null?void 0:E.toLowerCase().includes(a))||((T=m.suburb)==null?void 0:T.toLowerCase().includes(a))});b(l)},sx:{mb:4},InputProps:{startAdornment:e.jsx(o,{sx:{mr:1,color:"#9DA4AE"},children:e.jsx(J,{})})}})]}),g.length===0?e.jsxs(R,{sx:{border:"1px solid #E4E7EB",borderRadius:3,p:6,textAlign:"center"},children:[e.jsx(s,{variant:"h6",sx:{color:"#6B7280",mb:1},children:c.length===0?"No tutors pending approval":"No tutors match your search"}),e.jsx(s,{variant:"body2",sx:{color:"#9DA4AE"},children:c.length===0?"All tutors have been processed.":"Try adjusting your search criteria."})]}):e.jsx(i,{container:!0,spacing:3,children:g.map(r=>e.jsx(i,{item:!0,xs:12,md:6,lg:4,children:e.jsx(R,{sx:{height:"100%",border:"1px solid #E4E7EB",borderRadius:3,backgroundColor:"#FFFFFF",transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",borderColor:r.profile_complete?"#2D5BFF":"#F59E0B"}},children:e.jsxs(q,{sx:{p:4},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(B,{sx:{mr:2,bgcolor:"primary.main"},children:e.jsx(F,{})}),e.jsxs(o,{sx:{flex:1},children:[e.jsx(s,{variant:"h6",sx:{fontWeight:600},children:r.full_name}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:["Registered: ",new Date(r.created_at).toLocaleDateString()]})]})]}),e.jsxs(M,{spacing:1,sx:{mb:2},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Q,{fontSize:"small",color:"action"}),e.jsx(s,{variant:"body2",children:r.email})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(K,{fontSize:"small",color:"action"}),e.jsx(s,{variant:"body2",children:r.phone_number||"Not provided"})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(X,{fontSize:"small",color:"action"}),e.jsx(s,{variant:"body2",children:r.suburb||"Not provided"})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(V,{fontSize:"small",color:"action"}),e.jsxs(s,{variant:"body2",children:[r.subject_count," subjects"]})]})]}),e.jsxs(o,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[e.jsx(j,{label:r.approval_status,color:O(r.approval_status),size:"small"}),e.jsx(j,{label:r.review_status,color:U(r.review_status),variant:"outlined",size:"small"})]}),e.jsx(p,{variant:"contained",startIcon:e.jsx(Z,{}),onClick:()=>$(r.id),fullWidth:!0,disabled:!r.profile_complete,children:r.profile_complete?"Review Profile":"Profile Incomplete"})]})})},r.id))}),e.jsxs(ee,{open:L,onClose:()=>d(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(re,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(B,{src:t==null?void 0:t.profile_photo_url,sx:{width:60,height:60},children:e.jsx(F,{})}),e.jsxs(o,{children:[e.jsx(s,{variant:"h5",children:t==null?void 0:t.full_name}),e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Profile Review"})]})]})}),e.jsx(se,{children:t&&e.jsxs(o,{children:[e.jsxs(f,{sx:{p:2,mb:2},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"ðŸ“‹ Basic Information"}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:12,sm:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Email"}),e.jsx(s,{variant:"body1",children:t.email})]}),e.jsxs(i,{item:!0,xs:12,sm:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Phone"}),e.jsx(s,{variant:"body1",children:t.phone_number||"Not provided"})]}),e.jsxs(i,{item:!0,xs:12,sm:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Location"}),e.jsx(s,{variant:"body1",children:t.suburb||"Not provided"})]}),e.jsxs(i,{item:!0,xs:12,sm:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Registration Date"}),e.jsx(s,{variant:"body1",children:new Date(t.created_at).toLocaleDateString()})]})]})]}),e.jsxs(f,{sx:{p:2,mb:2},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"ðŸŽ“ Profile Information"}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:12,sm:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"University"}),e.jsx(s,{variant:"body1",children:t.university||"Not provided"})]}),e.jsxs(i,{item:!0,xs:12,sm:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Degree"}),e.jsx(s,{variant:"body1",children:t.degree||"Not provided"})]}),e.jsxs(i,{item:!0,xs:12,sm:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Study Year"}),e.jsx(s,{variant:"body1",children:t.study_year||"Not provided"})]}),e.jsxs(i,{item:!0,xs:12,sm:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"ATAR"}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(s,{variant:"body1",children:t.atar?t.atar:"Not provided"}),t.atar&&e.jsx(ae,{value:Math.min(5,Math.floor(t.atar/20)),readOnly:!0,size:"small"})]})]}),e.jsxs(i,{item:!0,xs:12,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Teaching Bio"}),e.jsx(s,{variant:"body1",sx:{fontStyle:t.teaching_bio?"normal":"italic"},children:t.teaching_bio||"Not provided"})]})]})]}),e.jsxs(f,{sx:{p:2,mb:2},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"ðŸ“š Teaching Subjects"}),t.subjects&&t.subjects.length>0?e.jsx(o,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:t.subjects.map((r,a)=>e.jsx(j,{label:`${r.subjects.name} (${r.subjects.state_curriculum} - ${r.subjects.level})`,variant:"outlined",size:"small"},a))}):e.jsx(s,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic"},children:"No subjects selected"})]}),e.jsx(N,{fullWidth:!0,label:"Approval Notes (optional)",multiline:!0,rows:3,value:_,onChange:r=>w(r.target.value),placeholder:"Add any notes about this approval decision...",sx:{mb:2}}),!t.profile_complete&&e.jsx(oe,{severity:"warning",sx:{mb:2},children:"This tutor's profile is incomplete. They need to fill out all required fields before approval."})]})}),e.jsxs(te,{children:[e.jsx(p,{onClick:()=>d(!1),children:"Cancel"}),e.jsx(p,{onClick:()=>A("rejected"),color:"error",startIcon:e.jsx(ie,{}),disabled:h,children:"Reject"}),e.jsx(p,{onClick:()=>A("approved"),color:"success",variant:"contained",startIcon:e.jsx(ne,{}),disabled:h||!(t!=null&&t.profile_complete),children:h?e.jsx(D,{size:20}):"Approve"})]})]})]})})}export{Ce as default};
